---
# Deploy sample VM and container for sanity.

- name: Install smoke test VM
  block:
    - name: Upload qemu image
      ansible.builtin.copy:
        dest: "{{ node_smoke_test_qemu_dst_vm }}"
        src: "{{ node_smoke_test_qemu_src_vm }}"
      register: node_qemu_smoke_vm

    - name: Create smoke VM
      when: node_qemu_smoke_vm.changed




- name: Install smoke test container
  block:
    - name: Make web index
      become: true
      ansible.builtin.shell: |
        mkdir -p /tmp/webroot
        echo '<html><body><h1>Hello from {{ ansible_default_ipv4.address }}</h1></body></html>' > /tmp/webroot/index.html
        chmod +r /tmp/webroot/index.html


    - name: Run web container
      containers.podman.podman_container:
        name: nginx
        image: docker.io/nginx
        state: started
        volumes:
          - /tmp/webroot:/usr/share/nginx/html
        # generate_systemd:
